<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R Programming for Research</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016.">
  <meta name="generator" content="bookdown 0.1.14 and GitBook 2.6.7">

  <meta property="og:title" content="R Programming for Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R Programming for Research" />
  
  <meta name="twitter:description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016." />
  

<meta name="author" content="Brooke Anderson and Rachel Severson">

  
<meta name="date" content="2016-10-03">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="entering-and-cleaning-data-2.html">
<link rel="next" href="appendix-a-vocabulary.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Authoring Books with R Markdown</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Online course book, ERHS 535</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html"><i class="fa fa-check"></i>Course information</a><ul>
<li class="chapter" data-level="0.1" data-path="course-information.html"><a href="course-information.html#course-overview"><i class="fa fa-check"></i><b>0.1</b> Course overview</a></li>
<li class="chapter" data-level="0.2" data-path="course-information.html"><a href="course-information.html#time-and-place"><i class="fa fa-check"></i><b>0.2</b> Time and place</a></li>
<li class="chapter" data-level="0.3" data-path="course-information.html"><a href="course-information.html#detailed-schedule"><i class="fa fa-check"></i><b>0.3</b> Detailed schedule</a></li>
<li class="chapter" data-level="0.4" data-path="course-information.html"><a href="course-information.html#grading"><i class="fa fa-check"></i><b>0.4</b> Grading</a><ul>
<li class="chapter" data-level="0.4.1" data-path="course-information.html"><a href="course-information.html#attendance-and-class-participation"><i class="fa fa-check"></i><b>0.4.1</b> Attendance and class participation</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path="course-information.html"><a href="course-information.html#weekly-in-course-group-exercises"><i class="fa fa-check"></i><b>0.5</b> Weekly in-course group exercises</a><ul>
<li class="chapter" data-level="0.5.1" data-path="course-information.html"><a href="course-information.html#in-class-quizzes"><i class="fa fa-check"></i><b>0.5.1</b> In-class quizzes</a></li>
<li class="chapter" data-level="0.5.2" data-path="course-information.html"><a href="course-information.html#homework"><i class="fa fa-check"></i><b>0.5.2</b> Homework</a></li>
<li class="chapter" data-level="0.5.3" data-path="course-information.html"><a href="course-information.html#final-group-project"><i class="fa fa-check"></i><b>0.5.3</b> Final group project</a></li>
</ul></li>
<li class="chapter" data-level="0.6" data-path="course-information.html"><a href="course-information.html#course-set-up"><i class="fa fa-check"></i><b>0.6</b> Course set-up</a></li>
<li class="chapter" data-level="0.7" data-path="course-information.html"><a href="course-information.html#helpful-books-for-learning-r"><i class="fa fa-check"></i><b>0.7</b> Helpful books for learning R</a></li>
</ul></li>
<li class="part"><span><b>Part I: Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="r-preliminaries.html"><a href="r-preliminaries.html"><i class="fa fa-check"></i><b>1</b> R Preliminaries</a><ul>
<li class="chapter" data-level="1.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-and-r-studio"><i class="fa fa-check"></i><b>1.1</b> R and R Studio</a><ul>
<li class="chapter" data-level="1.1.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#what-is-r"><i class="fa fa-check"></i><b>1.1.1</b> What is R?</a></li>
<li class="chapter" data-level="1.1.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#open-source-software"><i class="fa fa-check"></i><b>1.1.2</b> Open-source software</a></li>
<li class="chapter" data-level="1.1.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#what-is-rstudio"><i class="fa fa-check"></i><b>1.1.3</b> What is RStudio?</a></li>
<li class="chapter" data-level="1.1.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#setting-up"><i class="fa fa-check"></i><b>1.1.4</b> Setting up</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#the-package-system"><i class="fa fa-check"></i><b>1.2</b> The “package” system</a><ul>
<li class="chapter" data-level="1.2.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-packages"><i class="fa fa-check"></i><b>1.2.1</b> R packages</a></li>
<li class="chapter" data-level="1.2.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#installing-from-cran"><i class="fa fa-check"></i><b>1.2.2</b> Installing from CRAN</a></li>
<li class="chapter" data-level="1.2.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#loading-an-installed-package"><i class="fa fa-check"></i><b>1.2.3</b> Loading an installed package</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#basic-code-conventions-of-r"><i class="fa fa-check"></i><b>1.3</b> Basic code conventions of R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#rs-mvp-the-gets-arrow"><i class="fa fa-check"></i><b>1.3.1</b> R’s MVP: The <em>gets arrow</em></a></li>
<li class="chapter" data-level="1.3.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#assignment-operator-wars---vs."><i class="fa fa-check"></i><b>1.3.2</b> Assignment operator wars: <code>&lt;-</code> vs. <code>=</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#naming-objects"><i class="fa fa-check"></i><b>1.3.3</b> Naming objects</a></li>
<li class="chapter" data-level="1.3.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#commenting-code"><i class="fa fa-check"></i><b>1.3.4</b> Commenting code</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#rs-most-basic-object-types"><i class="fa fa-check"></i><b>1.4</b> R’s most basic object types</a><ul>
<li class="chapter" data-level="1.4.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#vectors"><i class="fa fa-check"></i><b>1.4.1</b> Vectors</a></li>
<li class="chapter" data-level="1.4.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#dataframes"><i class="fa fa-check"></i><b>1.4.2</b> Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="r-preliminaries.html"><a href="r-preliminaries.html#using-r-functions"><i class="fa fa-check"></i><b>1.5</b> Using R functions</a><ul>
<li class="chapter" data-level="1.5.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#function-structure"><i class="fa fa-check"></i><b>1.5.1</b> Function structure</a></li>
<li class="chapter" data-level="1.5.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#function-help-files"><i class="fa fa-check"></i><b>1.5.2</b> Function help files</a></li>
<li class="chapter" data-level="1.5.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#function-parameters"><i class="fa fa-check"></i><b>1.5.3</b> Function parameters</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="r-preliminaries.html"><a href="r-preliminaries.html#in-course-exercise"><i class="fa fa-check"></i><b>1.6</b> In-course Exercise</a><ul>
<li class="chapter" data-level="1.6.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#about-the-dataset"><i class="fa fa-check"></i><b>1.6.1</b> About the dataset</a></li>
<li class="chapter" data-level="1.6.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#getting-the-data-onto-your-computer"><i class="fa fa-check"></i><b>1.6.2</b> Getting the data onto your computer</a></li>
<li class="chapter" data-level="1.6.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#getting-the-data-into-r"><i class="fa fa-check"></i><b>1.6.3</b> Getting the data into R</a></li>
<li class="chapter" data-level="1.6.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#checking-out-the-data"><i class="fa fa-check"></i><b>1.6.4</b> Checking out the data</a></li>
<li class="chapter" data-level="1.6.5" data-path="r-preliminaries.html"><a href="r-preliminaries.html#using-the-data-to-answer-questions"><i class="fa fa-check"></i><b>1.6.5</b> Using the data to answer questions</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part II: Basics</b></span></li>
<li class="chapter" data-level="2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html"><i class="fa fa-check"></i><b>2</b> Entering and cleaning data #1</a><ul>
<li class="chapter" data-level="2.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#r-scripts"><i class="fa fa-check"></i><b>2.1</b> R scripts</a></li>
<li class="chapter" data-level="2.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#directories-and-pathnames"><i class="fa fa-check"></i><b>2.2</b> Directories and pathnames</a><ul>
<li class="chapter" data-level="2.2.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#directory-structure"><i class="fa fa-check"></i><b>2.2.1</b> Directory structure</a></li>
<li class="chapter" data-level="2.2.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#working-directory"><i class="fa fa-check"></i><b>2.2.2</b> Working directory</a></li>
<li class="chapter" data-level="2.2.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#file-and-directory-pathnames"><i class="fa fa-check"></i><b>2.2.3</b> File and directory pathnames</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#diversion-paste"><i class="fa fa-check"></i><b>2.3</b> Diversion: <code>paste</code></a></li>
<li class="chapter" data-level="2.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.4</b> Reading data into R</a><ul>
<li class="chapter" data-level="2.4.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-local-flat-files"><i class="fa fa-check"></i><b>2.4.1</b> Reading local flat files</a></li>
<li class="chapter" data-level="2.4.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#the-read_-functions"><i class="fa fa-check"></i><b>2.4.2</b> The <code>read_*</code> functions</a></li>
<li class="chapter" data-level="2.4.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-online-flat-files"><i class="fa fa-check"></i><b>2.4.3</b> Reading online flat files</a></li>
<li class="chapter" data-level="2.4.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#saving-and-loading-r-objects"><i class="fa fa-check"></i><b>2.4.4</b> Saving and loading R objects</a></li>
<li class="chapter" data-level="2.4.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-other-file-types"><i class="fa fa-check"></i><b>2.4.5</b> Reading other file types</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#data-cleaning"><i class="fa fa-check"></i><b>2.5</b> Data cleaning</a><ul>
<li class="chapter" data-level="2.5.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#renaming-columns"><i class="fa fa-check"></i><b>2.5.1</b> Renaming columns</a></li>
<li class="chapter" data-level="2.5.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#selecting-columns"><i class="fa fa-check"></i><b>2.5.2</b> Selecting columns</a></li>
<li class="chapter" data-level="2.5.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#filtering-to-certain-rows"><i class="fa fa-check"></i><b>2.5.3</b> Filtering to certain rows</a></li>
<li class="chapter" data-level="2.5.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#add-or-change-columns"><i class="fa fa-check"></i><b>2.5.4</b> Add or change columns</a></li>
<li class="chapter" data-level="2.5.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#piping"><i class="fa fa-check"></i><b>2.5.5</b> Piping</a></li>
<li class="chapter" data-level="2.5.6" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#base-r-equivalents-to-dplyr-functions"><i class="fa fa-check"></i><b>2.5.6</b> Base R equivalents to <code>dplyr</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#dates-in-r"><i class="fa fa-check"></i><b>2.6</b> Dates in R</a></li>
<li class="chapter" data-level="2.7" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#in-course-exercise-1"><i class="fa fa-check"></i><b>2.7</b> In-course Exercise</a><ul>
<li class="chapter" data-level="2.7.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#checking-out-directory-structures"><i class="fa fa-check"></i><b>2.7.1</b> Checking out directory structures</a></li>
<li class="chapter" data-level="2.7.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#using-relative-and-absolute-file-pathnames"><i class="fa fa-check"></i><b>2.7.2</b> Using relative and absolute file pathnames</a></li>
<li class="chapter" data-level="2.7.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-in-different-types-of-files"><i class="fa fa-check"></i><b>2.7.3</b> Reading in different types of files</a></li>
<li class="chapter" data-level="2.7.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#cleaning-up-data"><i class="fa fa-check"></i><b>2.7.4</b> Cleaning up data</a></li>
<li class="chapter" data-level="2.7.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#a-taste-of-whats-to-come"><i class="fa fa-check"></i><b>2.7.5</b> A taste of what’s to come…</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploring-data-1.html"><a href="exploring-data-1.html"><i class="fa fa-check"></i><b>3</b> Exploring data #1</a><ul>
<li class="chapter" data-level="3.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#data-from-a-package"><i class="fa fa-check"></i><b>3.1</b> Data from a package</a></li>
<li class="chapter" data-level="3.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#plots-to-explore-data"><i class="fa fa-check"></i><b>3.2</b> Plots to explore data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#initializing-a-ggplot-object"><i class="fa fa-check"></i><b>3.2.1</b> Initializing a ggplot object</a></li>
<li class="chapter" data-level="3.2.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#plot-aesthetics"><i class="fa fa-check"></i><b>3.2.2</b> Plot aesthetics</a></li>
<li class="chapter" data-level="3.2.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#adding-geoms"><i class="fa fa-check"></i><b>3.2.3</b> Adding geoms</a></li>
<li class="chapter" data-level="3.2.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#constant-aesthetics"><i class="fa fa-check"></i><b>3.2.4</b> Constant aesthetics</a></li>
<li class="chapter" data-level="3.2.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#useful-plot-additions"><i class="fa fa-check"></i><b>3.2.5</b> Useful plot additions</a></li>
<li class="chapter" data-level="3.2.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#example-dataset"><i class="fa fa-check"></i><b>3.2.6</b> Example dataset</a></li>
<li class="chapter" data-level="3.2.7" data-path="exploring-data-1.html"><a href="exploring-data-1.html#histograms"><i class="fa fa-check"></i><b>3.2.7</b> Histograms</a></li>
<li class="chapter" data-level="3.2.8" data-path="exploring-data-1.html"><a href="exploring-data-1.html#scatterplots"><i class="fa fa-check"></i><b>3.2.8</b> Scatterplots</a></li>
<li class="chapter" data-level="3.2.9" data-path="exploring-data-1.html"><a href="exploring-data-1.html#boxplots"><i class="fa fa-check"></i><b>3.2.9</b> Boxplots</a></li>
<li class="chapter" data-level="3.2.10" data-path="exploring-data-1.html"><a href="exploring-data-1.html#extensions-of-ggplot2"><i class="fa fa-check"></i><b>3.2.10</b> Extensions of <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#simple-statistics-functions"><i class="fa fa-check"></i><b>3.3</b> Simple statistics functions</a><ul>
<li class="chapter" data-level="3.3.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#summary-statistics"><i class="fa fa-check"></i><b>3.3.1</b> Summary statistics</a></li>
<li class="chapter" data-level="3.3.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#summarize-function"><i class="fa fa-check"></i><b>3.3.2</b> <code>summarize</code> function</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#logical-vectors"><i class="fa fa-check"></i><b>3.4</b> Logical vectors</a></li>
<li class="chapter" data-level="3.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#regression-models"><i class="fa fa-check"></i><b>3.5</b> Regression models</a><ul>
<li class="chapter" data-level="3.5.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#formula-structure"><i class="fa fa-check"></i><b>3.5.1</b> Formula structure</a></li>
<li class="chapter" data-level="3.5.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#linear-models"><i class="fa fa-check"></i><b>3.5.2</b> Linear models</a></li>
<li class="chapter" data-level="3.5.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#generalized-linear-models-glms"><i class="fa fa-check"></i><b>3.5.3</b> Generalized linear models (GLMs)</a></li>
<li class="chapter" data-level="3.5.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#references-statistics-in-r"><i class="fa fa-check"></i><b>3.5.4</b> References– statistics in R</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#in-course-exercise-2"><i class="fa fa-check"></i><b>3.6</b> In-course exercise</a><ul>
<li class="chapter" data-level="3.6.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#loading-data-from-an-r-package"><i class="fa fa-check"></i><b>3.6.1</b> Loading data from an R package</a></li>
<li class="chapter" data-level="3.6.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#basic-plots-of-the-data"><i class="fa fa-check"></i><b>3.6.2</b> Basic plots of the data</a></li>
<li class="chapter" data-level="3.6.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-simple-statistics-and-logical-statements"><i class="fa fa-check"></i><b>3.6.3</b> Exploring the data using simple statistics and logical statements</a></li>
<li class="chapter" data-level="3.6.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#using-regression-models-to-explore-data"><i class="fa fa-check"></i><b>3.6.4</b> Using regression models to explore data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html"><i class="fa fa-check"></i><b>4</b> Reporting data results #1</a><ul>
<li class="chapter" data-level="4.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#guidelines-for-good-plots"><i class="fa fa-check"></i><b>4.1</b> Guidelines for good plots</a></li>
<li class="chapter" data-level="4.2" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#high-data-density"><i class="fa fa-check"></i><b>4.2</b> High data density</a></li>
<li class="chapter" data-level="4.3" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#meaningful-labels"><i class="fa fa-check"></i><b>4.3</b> Meaningful labels</a></li>
<li class="chapter" data-level="4.4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#references"><i class="fa fa-check"></i><b>4.4</b> References</a></li>
<li class="chapter" data-level="4.5" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#highlighting"><i class="fa fa-check"></i><b>4.5</b> Highlighting</a></li>
<li class="chapter" data-level="4.6" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#order"><i class="fa fa-check"></i><b>4.6</b> Order</a></li>
<li class="chapter" data-level="4.7" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#small-multiples"><i class="fa fa-check"></i><b>4.7</b> Small multiples</a></li>
<li class="chapter" data-level="4.8" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#advanced-customization"><i class="fa fa-check"></i><b>4.8</b> Advanced customization</a><ul>
<li class="chapter" data-level="4.8.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#scales"><i class="fa fa-check"></i><b>4.8.1</b> Scales</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#to-find-out-more"><i class="fa fa-check"></i><b>4.9</b> To find out more</a></li>
<li class="chapter" data-level="4.10" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#in-course-exercise-3"><i class="fa fa-check"></i><b>4.10</b> In-course exercise</a><ul>
<li class="chapter" data-level="4.10.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#designing-a-plot"><i class="fa fa-check"></i><b>4.10.1</b> Designing a plot</a></li>
<li class="chapter" data-level="4.10.2" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#basic-scatterplots-with-r-base-graphics-and-ggplot"><i class="fa fa-check"></i><b>4.10.2</b> Basic scatterplots with R base graphics and ggplot</a></li>
<li class="chapter" data-level="4.10.3" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#fancier-graphs"><i class="fa fa-check"></i><b>4.10.3</b> Fancier graphs</a></li>
<li class="chapter" data-level="4.10.4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#data-visualization-cheatsheet"><i class="fa fa-check"></i><b>4.10.4</b> Data visualization cheatsheet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html"><i class="fa fa-check"></i><b>5</b> Reproducible research #1</a><ul>
<li class="chapter" data-level="5.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#what-is-reproducible-research"><i class="fa fa-check"></i><b>5.1</b> What is reproducible research?</a></li>
<li class="chapter" data-level="5.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#markdown"><i class="fa fa-check"></i><b>5.2</b> Markdown</a></li>
<li class="chapter" data-level="5.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#literate-programming-in-r"><i class="fa fa-check"></i><b>5.3</b> Literate programming in R</a></li>
<li class="chapter" data-level="5.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#style-guidelines"><i class="fa fa-check"></i><b>5.4</b> Style guidelines</a><ul>
<li class="chapter" data-level="5.4.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#line-length"><i class="fa fa-check"></i><b>5.4.1</b> Line length</a></li>
<li class="chapter" data-level="5.4.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#spacing"><i class="fa fa-check"></i><b>5.4.2</b> Spacing</a></li>
<li class="chapter" data-level="5.4.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#semicolons"><i class="fa fa-check"></i><b>5.4.3</b> Semicolons</a></li>
<li class="chapter" data-level="5.4.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#commenting"><i class="fa fa-check"></i><b>5.4.4</b> Commenting</a></li>
<li class="chapter" data-level="5.4.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#indentation"><i class="fa fa-check"></i><b>5.4.5</b> Indentation</a></li>
<li class="chapter" data-level="5.4.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#code-grouping"><i class="fa fa-check"></i><b>5.4.6</b> Code grouping</a></li>
<li class="chapter" data-level="5.4.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#broader-guidelines"><i class="fa fa-check"></i><b>5.4.7</b> Broader guidelines</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#more-with-knitr"><i class="fa fa-check"></i><b>5.5</b> More with knitr</a><ul>
<li class="chapter" data-level="5.5.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#equations-in-knitr"><i class="fa fa-check"></i><b>5.5.1</b> Equations in <code>knitr</code></a></li>
<li class="chapter" data-level="5.5.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#figures-from-file"><i class="fa fa-check"></i><b>5.5.2</b> Figures from file</a></li>
<li class="chapter" data-level="5.5.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#saving-graphics-files"><i class="fa fa-check"></i><b>5.5.3</b> Saving graphics files</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#saving-graphics-files-1"><i class="fa fa-check"></i><b>5.6</b> Saving graphics files</a><ul>
<li class="chapter" data-level="5.6.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#tables-in-r-markdown"><i class="fa fa-check"></i><b>5.6.1</b> Tables in R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#in-course-exercise-4"><i class="fa fa-check"></i><b>5.7</b> In-course exercise</a><ul>
<li class="chapter" data-level="5.7.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#creating-a-markdown-document"><i class="fa fa-check"></i><b>5.7.1</b> Creating a Markdown document</a></li>
<li class="chapter" data-level="5.7.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#adding-in-r-code"><i class="fa fa-check"></i><b>5.7.2</b> Adding in R code</a></li>
<li class="chapter" data-level="5.7.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#working-with-r-markdown-documents"><i class="fa fa-check"></i><b>5.7.3</b> Working with R Markdown documents</a></li>
<li class="chapter" data-level="5.7.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#r-style-guidelines"><i class="fa fa-check"></i><b>5.7.4</b> R style guidelines</a></li>
<li class="chapter" data-level="5.7.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#trying-out-knitr-with-your-own-data"><i class="fa fa-check"></i><b>5.7.5</b> Trying out <code>knitr</code> with your own data</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part III: Intermediate</b></span></li>
<li class="chapter" data-level="6" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html"><i class="fa fa-check"></i><b>6</b> Entering and cleaning data #2</a><ul>
<li class="chapter" data-level="6.1" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#joining-datasets"><i class="fa fa-check"></i><b>6.1</b> Joining datasets</a></li>
<li class="chapter" data-level="6.2" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#tidy-data"><i class="fa fa-check"></i><b>6.2</b> Tidy data</a></li>
<li class="chapter" data-level="6.3" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#gathering"><i class="fa fa-check"></i><b>6.3</b> Gathering</a></li>
<li class="chapter" data-level="6.4" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#in-course-exercise-5"><i class="fa fa-check"></i><b>6.4</b> In-course exercise</a><ul>
<li class="chapter" data-level="6.4.1" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#designing-tidy-data"><i class="fa fa-check"></i><b>6.4.1</b> Designing tidy data</a></li>
<li class="chapter" data-level="6.4.2" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#easier-data-wrangling"><i class="fa fa-check"></i><b>6.4.2</b> Easier data wrangling</a></li>
<li class="chapter" data-level="6.4.3" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#more-extensive-data-wrangling"><i class="fa fa-check"></i><b>6.4.3</b> More extensive data wrangling</a></li>
<li class="chapter" data-level="6.4.4" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#tidying-vadeaths-data"><i class="fa fa-check"></i><b>6.4.4</b> Tidying <code>VADeaths</code> data</a></li>
<li class="chapter" data-level="6.4.5" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#exploring-fatality-analysis-reporting-system-fars-data"><i class="fa fa-check"></i><b>6.4.5</b> Exploring Fatality Analysis Reporting System (FARS) data</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part III: Intermediate</b></span></li>
<li class="chapter" data-level="7" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html"><i class="fa fa-check"></i><b>7</b> Entering and cleaning data #2</a><ul>
<li class="chapter" data-level="7.1" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#parentheses"><i class="fa fa-check"></i><b>7.1</b> Parentheses</a></li>
<li class="chapter" data-level="7.2" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#loops"><i class="fa fa-check"></i><b>7.2</b> Loops</a></li>
<li class="chapter" data-level="7.3" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#functions"><i class="fa fa-check"></i><b>7.3</b> Functions</a></li>
<li class="chapter" data-level="7.4" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#apply-family-of-functions"><i class="fa fa-check"></i><b>7.4</b> <code>apply</code> family of functions</a></li>
<li class="chapter" data-level="7.5" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#in-course-exercise-6"><i class="fa fa-check"></i><b>7.5</b> In-course exercise</a><ul>
<li class="chapter" data-level="7.5.1" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#exploring-fatality-analysis-reporting-system-fars-data-1"><i class="fa fa-check"></i><b>7.5.1</b> Exploring Fatality Analysis Reporting System (FARS) data</a></li>
<li class="chapter" data-level="7.5.2" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#using-a-loop-to-create-state-specific-plots"><i class="fa fa-check"></i><b>7.5.2</b> Using a loop to create state-specific plots</a></li>
<li class="chapter" data-level="7.5.3" data-path="entering-and-cleaning-data-2-1.html"><a href="entering-and-cleaning-data-2-1.html#writing-a-function-to-create-state-specific-plots"><i class="fa fa-check"></i><b>7.5.3</b> Writing a function to create state-specific plots</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html"><i class="fa fa-check"></i><b>A</b> Appendix A: Vocabulary</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-1-quiz-1"><i class="fa fa-check"></i><b>A.1</b> Week 1 (Quiz 1)</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-2-quiz-2"><i class="fa fa-check"></i><b>A.2</b> Week 2 (Quiz 2)</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-3-quiz-3"><i class="fa fa-check"></i><b>A.3</b> Week 3 (Quiz 3)</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-4-quiz-4"><i class="fa fa-check"></i><b>A.4</b> Week 4 (Quiz 4)</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-5-quiz-5"><i class="fa fa-check"></i><b>A.5</b> Week 5 (Quiz 5)</a></li>
<li class="chapter" data-level="A.6" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-6-quiz-6"><i class="fa fa-check"></i><b>A.6</b> Week 6 (Quiz 6)</a></li>
<li class="chapter" data-level="A.7" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-7-quiz-7"><i class="fa fa-check"></i><b>A.7</b> Week 7 (Quiz 7)</a></li>
<li class="chapter" data-level="A.8" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#week-8-quiz-8"><i class="fa fa-check"></i><b>A.8</b> Week 8 (Quiz 8)</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html"><i class="fa fa-check"></i><b>B</b> Appendix B: Homework</a><ul>
<li class="chapter" data-level="B.1" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-1"><i class="fa fa-check"></i><b>B.1</b> Homework #1</a><ul>
<li class="chapter" data-level="B.1.1" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#getting-started"><i class="fa fa-check"></i><b>B.1.1</b> Getting started</a></li>
<li class="chapter" data-level="B.1.2" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#swirl-lessons"><i class="fa fa-check"></i><b>B.1.2</b> Swirl lessons</a></li>
<li class="chapter" data-level="B.1.3" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#special-swirl-commands"><i class="fa fa-check"></i><b>B.1.3</b> Special swirl commands</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-2"><i class="fa fa-check"></i><b>B.2</b> Homework #2</a></li>
<li class="chapter" data-level="B.3" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-3"><i class="fa fa-check"></i><b>B.3</b> Homework #3</a></li>
<li class="chapter" data-level="B.4" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-4"><i class="fa fa-check"></i><b>B.4</b> Homework #4</a></li>
<li class="chapter" data-level="B.5" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-5"><i class="fa fa-check"></i><b>B.5</b> Homework #5</a></li>
<li class="chapter" data-level="B.6" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-6"><i class="fa fa-check"></i><b>B.6</b> Homework #6</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Programming for Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="entering-and-cleaning-data-2-1" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Entering and cleaning data #2</h1>
<p><a href="https://github.com/geanders/RProgrammingForResearch/raw/master/slides/CourseNotes_Week7.pdf">Download</a> a pdf of the lecture slides covering this topic.</p>
<div id="parentheses" class="section level2">
<h2><span class="header-section-number">7.1</span> Parentheses</h2>
<p>If you put parentheses around an entire code statement, it will both run the code and print out the answer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
study_months</code></pre></div>
<pre><code>## [1] &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>))</code></pre></div>
<pre><code>## [1] &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot;</code></pre>
</div>
<div id="loops" class="section level2">
<h2><span class="header-section-number">7.2</span> Loops</h2>
<p>Loops allow you to “walk through” and repeat the same code for different values of an index. For each run of the loop, R is told that, for <strong>some index</strong> in <strong>some vector</strong>, do <strong>some code</strong>. For example, the following loop specifies: For <code>i</code> in <code>1:3</code>, <code>print(i)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)){
        <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<p>Note that this code is equivalent to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">1</span>
<span class="kw">print</span>(i)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">2</span>
<span class="kw">print</span>(i)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">3</span>
<span class="kw">print</span>(i)</code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Often, the index will be set to a number for each cycle of the loop, and then the index will be used within the code to index vectors or dataframes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
for(i in <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)){
        <span class="kw">print</span>(study_months[i])
}</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;
## [1] &quot;Mar&quot;</code></pre>
<p>Often, you want to set the index to sequential numbers (e.g., 1, 2, 3, 4). In this case, you can save time by using the <code>:</code> notation to create a vector of a sequence of numbers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:<span class="dv">3</span>){
        <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<p>With this notation, sometimes it may be helpful to use the <code>length</code> function to set the largest index value for the loop as the length of a vector (or <code>nrow</code> for indexing a dataframe). For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
for(i in <span class="dv">1</span>:<span class="kw">length</span>(study_months)){
        <span class="kw">print</span>(study_months[i])
}</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;
## [1] &quot;Feb&quot;
## [1] &quot;Mar&quot;</code></pre>
<p>Sometimes, you want to set the index for each cycle of the loop to something that is not a number. You can set the index to any class of vector.</p>
<p>Remember that a loop works by saying for <strong>some index</strong> in <strong>some vector</strong>, do <strong>some code</strong>. For example, you may want to run: for <code>study_month</code> in <code>study_months</code>, <code>print(study_month)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
for(study_month in study_months){
        <span class="kw">print</span>(study_month)
}</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;
## [1] &quot;Feb&quot;
## [1] &quot;Mar&quot;</code></pre>
<p>Note that this is equivalent to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_month &lt;-<span class="st"> &quot;Jan&quot;</span>
<span class="kw">print</span>(study_month)</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_month &lt;-<span class="st"> &quot;Feb&quot;</span>
<span class="kw">print</span>(study_month)</code></pre></div>
<pre><code>## [1] &quot;Feb&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_month &lt;-<span class="st"> &quot;Mar&quot;</span>
<span class="kw">print</span>(study_month)</code></pre></div>
<pre><code>## [1] &quot;Mar&quot;</code></pre>
<p>What would this loop do?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
for(i in <span class="dv">1</span>:<span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        <span class="kw">print</span>(var_mean)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
for(i in <span class="dv">1</span>:<span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        <span class="kw">print</span>(var_mean)
}</code></pre></div>
<pre><code>## [1] 208.8639
## [1] 2.304202
## [1] 84.52101
## [1] 4.191597
## [1] 0.6672269</code></pre>
<p>What would this loop do?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
for(i in <span class="dv">1</span>:<span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        var_mean &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
        out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean of &quot;</span>, vars[i], <span class="st">&quot;: &quot;</span>, var_mean)
        <span class="kw">print</span>(out)
}</code></pre></div>
<p>To figure out, you can set <code>i &lt;- 1</code> and then walk through the loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">1</span>
(var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]]))</code></pre></div>
<pre><code>## [1] 208.8639</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(var_mean &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>))</code></pre></div>
<pre><code>## [1] 208.9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean of &quot;</span>, vars[i], <span class="st">&quot;: &quot;</span>, var_mean))</code></pre></div>
<pre><code>## [1] &quot;mean of Time: 208.9&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
for(i in <span class="dv">1</span>:<span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        var_mean &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
        out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean of &quot;</span>, vars[i], <span class="st">&quot;: &quot;</span>, var_mean)
        <span class="kw">print</span>(out)
}</code></pre></div>
<pre><code>## [1] &quot;mean of Time: 208.9&quot;
## [1] &quot;mean of Shots: 2.3&quot;
## [1] &quot;mean of Passes: 84.5&quot;
## [1] &quot;mean of Tackles: 4.2&quot;
## [1] &quot;mean of Saves: 0.7&quot;</code></pre>
<p>Often, it’s convenient to create a dataset to fill up as you loop through:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
my_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">variable =</span> vars, <span class="dt">mean =</span> <span class="ot">NA</span>)
for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(my_df)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        my_df[i , <span class="st">&quot;mean&quot;</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
(my_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">variable =</span> vars, <span class="dt">mean =</span> <span class="ot">NA</span>))</code></pre></div>
<pre><code>##   variable mean
## 1     Time   NA
## 2    Shots   NA
## 3   Passes   NA
## 4  Tackles   NA
## 5    Saves   NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">1</span>
(var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]]))</code></pre></div>
<pre><code>## [1] 208.8639</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_df[i , <span class="st">&quot;mean&quot;</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
my_df</code></pre></div>
<pre><code>##   variable  mean
## 1     Time 208.9
## 2    Shots    NA
## 3   Passes    NA
## 4  Tackles    NA
## 5    Saves    NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(my_df)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        my_df[i , <span class="st">&quot;mean&quot;</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
}
my_df</code></pre></div>
<pre><code>##   variable  mean
## 1     Time 208.9
## 2    Shots   2.3
## 3   Passes  84.5
## 4  Tackles   4.2
## 5    Saves   0.7</code></pre>
<p>Note: This is a pretty simplistic example. There are some easier ways to have done this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">worldcup %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Time =</span> <span class="kw">mean</span>(Time), <span class="dt">Passes =</span> <span class="kw">mean</span>(Passes),
            <span class="dt">Shots =</span> <span class="kw">mean</span>(Shots), <span class="dt">Tackles =</span> <span class="kw">mean</span>(Tackles),
            <span class="dt">Saves =</span> <span class="kw">mean</span>(Saves)) %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> var, <span class="dt">value =</span> mean) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean =</span> <span class="kw">round</span>(mean, <span class="dv">1</span>))</code></pre></div>
<pre><code>##       var  mean
## 1    Time 208.9
## 2  Passes  84.5
## 3   Shots   2.3
## 4 Tackles   4.2
## 5   Saves   0.7</code></pre>
<p>Another way to have done this is with <code>apply</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means &lt;-<span class="st"> </span><span class="kw">apply</span>(worldcup[ , vars], <span class="dv">2</span>, mean)
(means &lt;-<span class="st"> </span><span class="kw">round</span>(means, <span class="dv">1</span>))</code></pre></div>
<pre><code>##    Time   Shots  Passes Tackles   Saves 
##   208.9     2.3    84.5     4.2     0.7</code></pre>
<p>However, you can use this same looping process for much more complex tasks that you can’t do as easily with <code>apply</code> or <code>dplyr</code> tools.</p>
<p>Loops can be very useful for more complex repeated tasks. For example:</p>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-360-1.png" width="576" /></p>
<p>Creating this graph requires:</p>
<ul>
<li>Create a subset limited to each of the four positions</li>
<li>Fit a Poisson regression of Passes on Time within each subset</li>
<li>Pull the regression coefficient and standard error from each model</li>
<li>Use those values to calculate 95% confidence intervals</li>
<li>Convert everything from log relative rate to relative rate</li>
<li>Plot everything</li>
</ul>
<p>Create a vector with the names of all positions. Create an empty dataframe to store regression results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(positions &lt;-<span class="st"> </span><span class="kw">unique</span>(worldcup$Position))</code></pre></div>
<pre><code>## [1] Midfielder Defender   Forward    Goalkeeper
## Levels: Defender Forward Goalkeeper Midfielder</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(pos_est &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">position =</span> positions,
                       <span class="dt">est =</span> <span class="ot">NA</span>, <span class="dt">se =</span> <span class="ot">NA</span>))</code></pre></div>
<pre><code>##     position est se
## 1 Midfielder  NA NA
## 2   Defender  NA NA
## 3    Forward  NA NA
## 4 Goalkeeper  NA NA</code></pre>
<p>Loop through and fit a Poisson regression model for each subset of data. Save regression coefficients in the empty dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(pos_est)){
        pos_df &lt;-<span class="st"> </span>worldcup %&gt;%
<span class="st">          </span><span class="kw">filter</span>(Position ==<span class="st"> </span>positions[i]) 
        pos_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(Passes ~<span class="st"> </span>Time,
                       <span class="dt">data =</span> pos_df,
                       <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>))
        pos_coefs &lt;-<span class="st"> </span><span class="kw">summary</span>(pos_mod)$coefficients[<span class="dv">2</span>, <span class="dv">1</span>:<span class="dv">2</span>]
        pos_est[i, <span class="kw">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;se&quot;</span>)] &lt;-<span class="st"> </span>pos_coefs
}
pos_est[<span class="dv">1</span>:<span class="dv">2</span>, ]</code></pre></div>
<pre><code>##     position         est           se
## 1 Midfielder 0.004716096 4.185925e-05
## 2   Defender 0.004616260 5.192736e-05</code></pre>
<p>Calculate 95% confidence intervals for log relative risk values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pos_est &lt;-<span class="st"> </span>pos_est %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lower_ci =</span> est -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se,
         <span class="dt">upper_ci =</span> est +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se)

pos_est %&gt;%
<span class="st">  </span><span class="kw">select</span>(position, est, lower_ci, upper_ci) </code></pre></div>
<pre><code>##     position         est    lower_ci    upper_ci
## 1 Midfielder 0.004716096 0.004634052 0.004798140
## 2   Defender 0.004616260 0.004514483 0.004718038
## 3    Forward 0.005299009 0.005158945 0.005439074
## 4 Goalkeeper 0.003101124 0.002770562 0.003431687</code></pre>
<p>Calculate relative risk per 90 minute increase in minutes played.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pos_est &lt;-<span class="st"> </span>pos_est %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rr_est =</span> <span class="kw">exp</span>(<span class="dv">90</span> *<span class="st"> </span>est),
         <span class="dt">rr_low =</span> <span class="kw">exp</span>(<span class="dv">90</span> *<span class="st"> </span>lower_ci),
         <span class="dt">rr_high =</span> <span class="kw">exp</span>(<span class="dv">90</span> *<span class="st"> </span>upper_ci))
pos_est %&gt;%
<span class="st">  </span><span class="kw">select</span>(position, rr_est, rr_low, rr_high) </code></pre></div>
<pre><code>##     position   rr_est   rr_low  rr_high
## 1 Midfielder 1.528747 1.517501 1.540077
## 2   Defender 1.515073 1.501258 1.529015
## 3    Forward 1.611090 1.590908 1.631527
## 4 Goalkeeper 1.321941 1.283192 1.361861</code></pre>
<p>Re-level the <code>position</code> factor so the plot will be ordered from highest to lowest estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pos_est &lt;-<span class="st"> </span><span class="kw">arrange</span>(pos_est, rr_est) %&gt;%
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">position =</span> <span class="kw">factor</span>(position,
                                 <span class="dt">levels =</span> position))
pos_est %&gt;%<span class="st"> </span><span class="kw">select</span>(position, est)</code></pre></div>
<pre><code>##     position         est
## 1 Goalkeeper 0.003101124
## 2   Defender 0.004616260
## 3 Midfielder 0.004716096
## 4    Forward 0.005299009</code></pre>
<p>Create the plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(pos_est, <span class="kw">aes</span>(<span class="dt">x =</span> rr_low, <span class="dt">y =</span> position)) +<span class="st"> </span>
<span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> rr_high, <span class="dt">yend =</span> position)) +<span class="st"> </span>
<span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rr_est, <span class="dt">y =</span> position)) +<span class="st"> </span>
<span class="st">        </span><span class="kw">theme_few</span>() +<span class="st"> </span>
<span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span>
<span class="st">        </span><span class="kw">scale_x_continuous</span>(<span class="kw">paste</span>(<span class="st">&quot;Relative rate of passes</span><span class="ch">\n</span><span class="st">per&quot;</span>,
                                 <span class="st">&quot;90 minute increase in minutes played&quot;</span>),
                           <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">1.0</span>, <span class="kw">max</span>(pos_est$rr_high))) +<span class="st"> </span>
<span class="st">        </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>), <span class="dt">color =</span> <span class="st">&quot;lightgray&quot;</span>)</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-366-1.png" width="576" /></p>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">7.3</span> Functions</h2>
<p>You can write your own functions for tasks you do a lot. </p>
<p>If you find yourself cutting and pasting a lot, convert the code to a function. Here is an example of a very basic function. This function takes a number as input and adds 1 to that number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_one &lt;-<span class="st"> </span>function(number){
        out &lt;-<span class="st"> </span>number +<span class="st"> </span><span class="dv">1</span>
        <span class="kw">return</span>(out)
}

<span class="kw">add_one</span>(<span class="dt">number =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_one</span>(<span class="dt">number =</span> -<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>You can name a function anything you want (although try to avoid names of pre-existing functions). You then include options (including any defaults) and the code to run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Note: this code will not run
[function name] &lt;-<span class="st"> </span>function([any options and defaults]){
        [code to run]
}</code></pre></div>
<p>Example: You want to take a log relative rate estimate determined per minute and convert it to a relative rate per 90 minutes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rr_per90 &lt;-<span class="st"> </span>function(log_rr){
        out &lt;-<span class="st"> </span><span class="kw">exp</span>(log_rr *<span class="st"> </span><span class="dv">90</span>)
        <span class="kw">return</span>(out)
}
<span class="kw">rr_per90</span>(pos_est$est[<span class="dv">1</span>])</code></pre></div>
<pre><code>## [1] 1.321941</code></pre>
<p>Example: You want to take a vector of values for a log relative rate estimate and its standard error and convert it to a pretty format of relative rate and confidence intervals per 90 minute increase in playing time:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pretty_rr90 &lt;-<span class="st"> </span>function(vec){
        ests &lt;-<span class="st"> </span>vec[<span class="dv">1</span>] +<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, -<span class="dv">1</span>, <span class="dv">1</span>) *<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>vec[<span class="dv">2</span>]
        ests &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(<span class="dv">90</span> *<span class="st"> </span>ests), <span class="dv">2</span>)
        out &lt;-<span class="st"> </span><span class="kw">paste0</span>(ests[<span class="dv">1</span>], <span class="st">&quot; (&quot;</span>, ests[<span class="dv">2</span>], <span class="st">&quot;, &quot;</span>, ests[<span class="dv">3</span>], <span class="st">&quot;)&quot;</span>)
        <span class="kw">return</span>(out)
}
<span class="kw">pretty_rr90</span>(<span class="kw">c</span>(<span class="fl">0.0031</span>, <span class="fl">0.00017</span>))</code></pre></div>
<pre><code>## [1] &quot;1.32 (1.28, 1.36)&quot;</code></pre>
<p>You can test out functions by walking through them, just like you can with loops.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.0031</span>, <span class="fl">0.00017</span>)
(ests &lt;-<span class="st"> </span>vec[<span class="dv">1</span>] +<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, -<span class="dv">1</span>, <span class="dv">1</span>) *<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>vec[<span class="dv">2</span>])</code></pre></div>
<pre><code>## [1] 0.0031000 0.0027668 0.0034332</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ests &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(<span class="dv">90</span> *<span class="st"> </span>ests), <span class="dv">2</span>))</code></pre></div>
<pre><code>## [1] 1.32 1.28 1.36</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(out &lt;-<span class="st"> </span><span class="kw">paste0</span>(ests[<span class="dv">1</span>], <span class="st">&quot; (&quot;</span>, ests[<span class="dv">2</span>], <span class="st">&quot;, &quot;</span>, ests[<span class="dv">3</span>], <span class="st">&quot;)&quot;</span>))</code></pre></div>
<pre><code>## [1] &quot;1.32 (1.28, 1.36)&quot;</code></pre>
<p>You can use <code>apply</code> to apply a function you’ve created to many rows at a time. For example, you have log relative risk estimates and standard errors for each position in <code>pos_est</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pos_est[ , <span class="kw">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;se&quot;</span>)]</code></pre></div>
<pre><code>##           est           se
## 1 0.003101124 1.686543e-04
## 2 0.004616260 5.192736e-05
## 3 0.004716096 4.185925e-05
## 4 0.005299009 7.146148e-05</code></pre>
<p>You can apply <code>pretty_rr90</code> to each row (<code>MARGIN = 1</code>) of this part of the dataframe to get pretty estimates for each position:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">apply</span>(pos_est[ , <span class="kw">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;se&quot;</span>)], <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> pretty_rr90)</code></pre></div>
<pre><code>## [1] &quot;1.32 (1.28, 1.36)&quot; &quot;1.52 (1.5, 1.53)&quot;  &quot;1.53 (1.52, 1.54)&quot;
## [4] &quot;1.61 (1.59, 1.63)&quot;</code></pre>
<p>You can use this to create a table to print:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_tab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;Position&quot;</span> =<span class="st"> </span>pos_est$position,
                      <span class="st">&quot;Effect Estimate&quot;</span> =<span class="st"> </span><span class="kw">apply</span>(pos_est[ , <span class="kw">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;se&quot;</span>)],
                                                <span class="dt">MARGIN =</span> <span class="dv">1</span>,
                                                <span class="dt">FUN =</span> pretty_rr90))
out_tab</code></pre></div>
<pre><code>##     Position   Effect.Estimate
## 1 Goalkeeper 1.32 (1.28, 1.36)
## 2   Defender  1.52 (1.5, 1.53)
## 3 Midfielder 1.53 (1.52, 1.54)
## 4    Forward 1.61 (1.59, 1.63)</code></pre>
<p>And use <code>knitr</code>’s <code>kable()</code> function to print it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(out_tab, <span class="dt">format =</span> <span class="st">&quot;markdown&quot;</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Position</th>
<th align="left">Effect.Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Goalkeeper</td>
<td align="left">1.32 (1.28, 1.36)</td>
</tr>
<tr class="even">
<td align="left">Defender</td>
<td align="left">1.52 (1.5, 1.53)</td>
</tr>
<tr class="odd">
<td align="left">Midfielder</td>
<td align="left">1.53 (1.52, 1.54)</td>
</tr>
<tr class="even">
<td align="left">Forward</td>
<td align="left">1.61 (1.59, 1.63)</td>
</tr>
</tbody>
</table>
</div>
<div id="apply-family-of-functions" class="section level2">
<h2><span class="header-section-number">7.4</span> <code>apply</code> family of functions</h2>
<p>First, you need to know about two more object types in R:</p>
<ul>
<li><code>matrix</code></li>
<li><code>list</code></li>
</ul>
<p>A matrix is like a dataframe, but all the values in all columns must be of the same class (e.g., numeric, character):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">foo &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">ncol =</span> <span class="dv">5</span>)
foo</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    3    5    7    9
## [2,]    2    4    6    8   10</code></pre>
<p>The matrix will default to make all values the most general class of any of the values, in any column. For example, if we replaced one numeric value with the character “a”, everything would turn into a character:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">foo[<span class="dv">1</span>, <span class="dv">1</span>] &lt;-<span class="st"> &quot;a&quot;</span>
foo</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,] &quot;a&quot;  &quot;3&quot;  &quot;5&quot;  &quot;7&quot;  &quot;9&quot; 
## [2,] &quot;2&quot;  &quot;4&quot;  &quot;6&quot;  &quot;8&quot;  &quot;10&quot;</code></pre>
<p>R uses matrices a lot for its underlying math (e.g., for the linear algebra operations required for fitting regression models). R can do matrix operations quite quickly.</p>
<p>A list has different elements, just like a dataframe has different columns. However, the different elements of a list can have different lengths (unlike the columns of a dataframe). The different elements can also have different classes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bar &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),
            <span class="dt">b =</span> <span class="dv">1</span>:<span class="dv">5</span>, 
            <span class="dt">c =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>))
bar</code></pre></div>
<pre><code>## $a
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;
## 
## $b
## [1] 1 2 3 4 5
## 
## $c
## [1]  TRUE FALSE</code></pre>
<p>To index an element from a list, use double square brackets. You can use this either with numbers (which element in the list?) or with names or the <code>$</code> operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bar[[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bar[[<span class="st">&quot;b&quot;</span>]]</code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bar$c</code></pre></div>
<pre><code>## [1]  TRUE FALSE</code></pre>
<p>Lists can be used to contain data with an unusual structure and / or lots of different components. For example, the information from fitting a regression is often stored as a list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>) ~<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">10</span>))
<span class="kw">is.list</span>(my_mod)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">names</span>(my_mod))</code></pre></div>
<pre><code>## [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;fitted.values&quot; &quot;effects&quot;      
## [5] &quot;R&quot;             &quot;rank&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_mod[[<span class="st">&quot;coefficients&quot;</span>]]</code></pre></div>
<pre><code>## (Intercept)     c(1:10) 
##   1.0050931  -0.1429895</code></pre>
<p>There is also a whole family of <code>apply</code> functions, as part of R’s based package. These include:</p>
<ul>
<li><code>apply</code>: Apply a function over all the rows (<code>MARGIN = 1</code>) or columns (<code>MARGIN = 2</code>) of a matrix</li>
<li><code>lapply</code>: Apply a function over elements of a list.</li>
<li><code>sapply</code>: Like <code>lapply</code>, but returns a vector instead of a list.</li>
</ul>
<p>Convention for <code>apply</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">apply</span>([matrix], <span class="dt">MARGIN =</span> [<span class="kw">margin</span> (<span class="dv">1</span>:<span class="st"> </span>rows, <span class="dv">2</span>:<span class="st"> </span>columns)], <span class="dt">FUN =</span>  [function])</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ex &lt;-<span class="st"> </span>worldcup[ , <span class="kw">c</span>(<span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)]
<span class="kw">head</span>(ex)</code></pre></div>
<pre><code>##            Shots Passes Tackles Saves
## Abdoun         0      6       0     0
## Abe            0    101      14     0
## Abidal         0     91       6     0
## Abou Diaby     1    111       5     0
## Aboubakar      2     16       0     0
## Abreu          0     15       0     0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">apply</span>(ex, <span class="dt">MARGIN =</span> <span class="dv">2</span>, mean)</code></pre></div>
<pre><code>##      Shots     Passes    Tackles      Saves 
##  2.3042017 84.5210084  4.1915966  0.6672269</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">apply</span>(ex, <span class="dt">MARGIN =</span> <span class="dv">1</span>, sum))</code></pre></div>
<pre><code>##     Abdoun        Abe     Abidal Abou Diaby  Aboubakar      Abreu 
##          6        115         97        117         18         15</code></pre>
<p><code>lapply()</code> will apply a function across a list. The different elements of the list do not have to be the same length (unlike a dataframe, where the columns all have to have the same length).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ex &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">5</span>), <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">3</span>), <span class="dt">c =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>)))</code></pre></div>
<pre><code>## $a
## [1] 1 2 3 4 5
## 
## $b
## [1] -2.1852380 -0.2759569 -1.2765488
## 
## $c
## [1] 5 3 3 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(ex, <span class="dt">FUN =</span> mean)</code></pre></div>
<pre><code>## $a
## [1] 3
## 
## $b
## [1] -1.245915
## 
## $c
## [1] 3.25</code></pre>
<p><code>sapply()</code> also applies a function over a list, but it returns a vector rather than a list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(ex, <span class="dt">FUN =</span> mean)</code></pre></div>
<pre><code>##         a         b         c 
##  3.000000 -1.245915  3.250000</code></pre>
<p>This can often be convenient in the context of a large data analysis.</p>
<p>In practice, I do use <code>apply()</code> some, but I can often find a way to do similar things to other <code>apply</code> family functions using the tools in <code>dplyr</code>.</p>
<p>You should know that <code>apply</code> family functions take advantage of the matrix structure in R. This can be one of the fastest way to run code in R. It is definitely faster than doing the same things with loops. However, unless you are working with large datasets, you may not notice a difference.</p>
<p>I would recommend using whichever method makes the most sense to you until you run into an analysis that takes a noticable amount of time to run, and then you might want to work a bit more to optimize your code.</p>
</div>
<div id="in-course-exercise-6" class="section level2">
<h2><span class="header-section-number">7.5</span> In-course exercise</h2>
<div id="exploring-fatality-analysis-reporting-system-fars-data-1" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Exploring Fatality Analysis Reporting System (FARS) data</h3>
<ul>
<li>Visit <a href="http://metrocosm.com/10-years-of-traffic-accidents-mapped.html" class="uri">http://metrocosm.com/10-years-of-traffic-accidents-mapped.html</a> and explore the interactive visualization created by Max Galka using this public dataset on US fatal motor vehicle accidents.</li>
<li>Go to <a href="http://www.nhtsa.gov/FARS">FARS web page</a> to find and download the data for this week’s exercise. We want to get the raw data on fatal accidents. Navigate this page to figure out how you can get this raw data for the whole county for 2015. Download the 2015 data to your computer. What is the structure of how this data is saved (e.g., directory structure, file structure)?</li>
<li>On the <a href="http://www.nhtsa.gov/FARS">FARS web page</a>, find the documentation describing this raw data. Look through both this documentation and the raw files you downloaded to figure out what information is included in the data.</li>
<li>Read the <code>accident.csv</code> file for 2015 into R (this is one of the files you’ll get if you download the raw data for 2015). Use the documentation to figure out what each column represents.</li>
<li>Discuss what steps you would need to take to create the following plot. To start, don’t write any code, just develop a plan. Talk about what the dataset should look like right before you create the plot and what functions you could use to get the data from its current format to that format. (Hint: Functions from the <code>lubridate</code> package will be very helpful, including <code>yday</code> and <code>wday</code>).</li>
<li>Discuss which of the variables in this dataset could be used to merge the dataset with other appropriate data, either other datasets in the FARS raw data, or outside datasets.</li>
<li>Try to write the code to create the plot below. This will include some code for cleaning the data and some code for plotting. I will add one example answer after class, but I’d like you to try to figure it out yourselves first.</li>
</ul>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-388-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="using-a-loop-to-create-state-specific-plots" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Using a loop to create state-specific plots</h3>
<p>Next, you will write a loop to write a four-page pdf file with state-specific plots for the states of Colorado, Texas, California, and New York.</p>
<ul>
<li>The data has a column called <code>STATE</code>, but it gives state as a one- or two-digit code, rather than by name. These codes are the state Federal Information Processing Standard (FIPS) codes. A dataset with state names and FIPS codes is available at <a href="http://www2.census.gov/geo/docs/reference/state.txt" class="uri">http://www2.census.gov/geo/docs/reference/state.txt</a>. Read that data into an R object called <code>state_fips</code> and clean it so the first few lines look like this:</li>
</ul>
<pre><code>## # A tibble: 5 × 2
##   state state_name
##   &lt;int&gt;      &lt;chr&gt;
## 1     1    Alabama
## 2     2     Alaska
## 3     4    Arizona
## 4     5   Arkansas
## 5     6 California</code></pre>
<ul>
<li>Read the 2015 FARS data into an R object named <code>accident</code>. Use all the date and time information to create a column named <code>date</code> with the date and time of the accident. Include information on whether the accident was related to drunk driving (FALSE if there were 0 drunk drivers, TRUE if there were one or more), and create columns that gives whether the accident was during the day (7 AM to 7 PM) or not as well as the month of the accident (for this last column, you can either retain it from the original data or recalculate it based on the new <code>date</code> variable). Filter out any values where the date-time does not render (i.e., <code>date</code> is a missing value). The first few rows of the cleaned dataframe should look like this:</li>
</ul>
<pre><code>## # A tibble: 5 × 5
##   state                date drunk_dr daytime month
##   &lt;int&gt;              &lt;dttm&gt;    &lt;lgl&gt;   &lt;lgl&gt; &lt;dbl&gt;
## 1     1 2015-01-01 02:40:00     TRUE   FALSE     1
## 2     1 2015-01-01 22:13:00    FALSE   FALSE     1
## 3     1 2015-01-01 01:25:00     TRUE   FALSE     1
## 4     1 2015-01-04 00:57:00     TRUE   FALSE     1
## 5     1 2015-01-07 07:09:00    FALSE    TRUE     1</code></pre>
<ul>
<li>Join the information from <code>state_fips</code> into the <code>accident</code> dataframe. There may be a few locations in the <code>state_fips</code> dataframe that are not included in the <code>accident</code> dataframe (e.g., Virgin Islands), so when you join keep all observations in <code>accident</code> but only the observations in <code>state_fips</code> that match at least one row of <code>accident</code>. The first few rows of the joined dataset should look like this:</li>
</ul>
<pre><code>## # A tibble: 5 × 6
##   state                date drunk_dr daytime month state_name
##   &lt;int&gt;              &lt;dttm&gt;    &lt;lgl&gt;   &lt;lgl&gt; &lt;dbl&gt;      &lt;chr&gt;
## 1     1 2015-01-01 02:40:00     TRUE   FALSE     1    Alabama
## 2     1 2015-01-01 22:13:00    FALSE   FALSE     1    Alabama
## 3     1 2015-01-01 01:25:00     TRUE   FALSE     1    Alabama
## 4     1 2015-01-04 00:57:00     TRUE   FALSE     1    Alabama
## 5     1 2015-01-07 07:09:00    FALSE    TRUE     1    Alabama</code></pre>
<ul>
<li>Write the code to create boxplots for Colorado of the distribution of total accidents within each month. Create separate boxplots for daytime and nighttime accidents, and facet by whether the accident was related to drunk driving. The plot should look like the plot below.</li>
</ul>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-392-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>Write a loop to create a plot like the one you just made for Colorado for four different states– Colorado, Texas, California, and New York. The code should write the plots out to a pdf, with one plot per page of the pdf. (<em>Hint</em>: To get a loop to print out a plot created with ggplot, you must explicitly print the plot object. For example, you could assign the plot to <code>a</code>, and then you would run <code>print(a)</code> within your loop as the last step.)</li>
</ul>
<div id="example-r-code-10" class="section level4">
<h4><span class="header-section-number">7.5.2.1</span> Example R code</h4>
<p>Here is example R code for creating state-specific plots using a loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">state_fips &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;http://www2.census.gov/geo/docs/reference/state.txt&quot;</span>,
                         <span class="dt">delim =</span> <span class="st">&quot;|&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> STATE,
         <span class="dt">state_name =</span> STATE_NAME) %&gt;%
<span class="st">  </span><span class="kw">select</span>(state, state_name) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">as.integer</span>(state))

accident &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/accident.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(STATE, DAY:MINUTE, DRUNK_DR) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> STATE, 
         <span class="dt">drunk_dr =</span> DRUNK_DR) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-DAY_WEEK) %&gt;%
<span class="st">  </span><span class="kw">unite</span>(date, DAY:MINUTE, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">dmy_hm</span>(date), 
         <span class="dt">drunk_dr =</span> drunk_dr &gt;=<span class="st"> </span><span class="dv">1</span>,
         <span class="dt">daytime =</span> <span class="kw">hour</span>(date) %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>:<span class="dv">19</span>),
         <span class="dt">month =</span> <span class="kw">month</span>(date)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(date)) %&gt;%
<span class="st">  </span><span class="kw">left_join</span>(state_fips, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>)

<span class="kw">pdf</span>(<span class="st">&quot;StateFARSPlots.pdf&quot;</span>, <span class="dt">height =</span> <span class="fl">3.5</span>, <span class="dt">width =</span> <span class="dv">7</span>)
state_list &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Colorado&quot;</span>, <span class="st">&quot;Texas&quot;</span>, <span class="st">&quot;California&quot;</span>, <span class="st">&quot;New York&quot;</span>)
for(which_state in state_list){
  a &lt;-accident %&gt;%
<span class="st">    </span><span class="kw">filter</span>(state_name ==<span class="st"> </span>which_state) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">drunk_dr =</span> <span class="kw">factor</span>(drunk_dr, <span class="dt">labels =</span> 
                               <span class="kw">c</span>(<span class="st">&quot;Unrelated to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>,
                                 <span class="st">&quot;Related to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>)),
           <span class="dt">daytime =</span> <span class="kw">factor</span>(daytime, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Nighttime&quot;</span>, <span class="st">&quot;Daytime&quot;</span>))) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(daytime, month, drunk_dr) %&gt;%
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">accidents =</span> <span class="kw">n</span>()) %&gt;%
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> daytime, <span class="dt">y =</span> accidents, <span class="dt">group =</span> daytime)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_boxplot</span>() +<span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>drunk_dr, <span class="dt">ncol =</span> <span class="dv">2</span>) +
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;# of monthly accidents&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Fatal accidents in&quot;</span>, which_state, <span class="st">&quot;in 2015&quot;</span>))
  <span class="kw">print</span>(a)
}
<span class="kw">dev.off</span>()</code></pre></div>
</div>
</div>
<div id="writing-a-function-to-create-state-specific-plots" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Writing a function to create state-specific plots</h3>
<ul>
<li>Adapt the code that you wrote for the loop and write a function that will create a state-specific plot when you call it. This function should have inputs of <code>datafr</code> and <code>which_state</code>, where <code>datafr</code> is the dataframe with the full dataset (<code>accident</code> in this case) and <code>which_state</code> is the name of the state for which you’d like to create the plot. Name your functions <code>make_state_plot</code>. Here are a few examples of running this function:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_state_plot</span>(accident, <span class="dt">which_state =</span> <span class="st">&quot;California&quot;</span>)</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-395-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_state_plot</span>(accident, <span class="dt">which_state =</span> <span class="st">&quot;North Carolina&quot;</span>)</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-395-2.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_state_plot</span>(accident, <span class="dt">which_state =</span> <span class="st">&quot;Illinois&quot;</span>)</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-395-3.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>In general, there is a pattern of more of the fatal accidents during the daytime are unrelated to drunk driving versus related, while the pattern is reversed for nighttime accidents. Use your function to see if you can find any states that don’t follow this pattern.</li>
<li>So far, we have not covered error checking in functions. In the function that you just wrote, we are assuming that the user will never give inputs that would cause errors. Look through the code for your function and see what assumptions we’re making about what values a user would input for <code>datafr</code> and <code>which_state</code>. What could go wrong if a user does not comply with these assumptions?</li>
<li>The best practice when writing functions, especially for others to use, is to use the package::function syntax to identify which package each function comes from. For example, if you’re using <code>mutate</code> in a function, you should write the function code as <code>dplyr::mutate</code>. Go back through the code for the function you wrote. Every time it uses a function that is not part of base R, change the code to use this package::function syntax.</li>
</ul>
<div id="example-r-code-11" class="section level4">
<h4><span class="header-section-number">7.5.3.1</span> Example R code</h4>
<p>Here is some example R code for writing the function to create state-specific plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">make_state_plot &lt;-<span class="st"> </span>function(datafr, which_state){
  a &lt;-<span class="st"> </span>datafr %&gt;%
<span class="st">    </span><span class="kw">filter</span>(state_name ==<span class="st"> </span>which_state) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">drunk_dr =</span> <span class="kw">factor</span>(drunk_dr,
                             <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Unrelated to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>,
                                        <span class="st">&quot;Related to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>)),
           <span class="dt">daytime =</span> <span class="kw">factor</span>(daytime, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Nighttime&quot;</span>, <span class="st">&quot;Daytime&quot;</span>))) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(daytime, month, drunk_dr) %&gt;%
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">accidents =</span> <span class="kw">n</span>()) %&gt;%
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> daytime, <span class="dt">y =</span> accidents, <span class="dt">group =</span> daytime)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_boxplot</span>() +<span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>drunk_dr, <span class="dt">ncol =</span> <span class="dv">2</span>) +
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;# of monthly accidents&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Fatal accidents in&quot;</span>, which_state, <span class="st">&quot;in 2015&quot;</span>))
  <span class="kw">return</span>(a)
}

<span class="co"># With package::function notation</span>
make_state_plot &lt;-<span class="st"> </span>function(datafr, which_state){
  a &lt;-<span class="st"> </span>datafr %&gt;%
<span class="st">    </span>dplyr::<span class="kw">filter</span>(state_name ==<span class="st"> </span>which_state) %&gt;%
<span class="st">    </span>dplyr::<span class="kw">mutate</span>(<span class="dt">drunk_dr =</span> <span class="kw">factor</span>(drunk_dr,
                             <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Unrelated to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>,
                                        <span class="st">&quot;Related to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>)),
           <span class="dt">daytime =</span> <span class="kw">factor</span>(daytime, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Nighttime&quot;</span>, <span class="st">&quot;Daytime&quot;</span>))) %&gt;%
<span class="st">    </span>dplyr::<span class="kw">group_by</span>(daytime, month, drunk_dr) %&gt;%
<span class="st">    </span>dplyr::<span class="kw">summarize</span>(<span class="dt">accidents =</span> <span class="kw">n</span>()) %&gt;%
<span class="st">    </span>ggplot2::<span class="kw">ggplot</span>(ggplot2::<span class="kw">aes</span>(<span class="dt">x =</span> daytime, <span class="dt">y =</span> accidents,
                                 <span class="dt">group =</span> daytime)) +<span class="st"> </span>
<span class="st">    </span>ggplot2::<span class="kw">geom_boxplot</span>() +<span class="st"> </span>
<span class="st">    </span>ggplot2::<span class="kw">facet_wrap</span>(~<span class="st"> </span>drunk_dr, <span class="dt">ncol =</span> <span class="dv">2</span>) +
<span class="st">    </span>ggplot2::<span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) +<span class="st"> </span>ggplot2::<span class="kw">ylab</span>(<span class="st">&quot;# of monthly accidents&quot;</span>) +<span class="st"> </span>
<span class="st">    </span>ggplot2::<span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Fatal accidents in&quot;</span>, which_state, <span class="st">&quot;in 2015&quot;</span>))
  <span class="kw">return</span>(a)
}</code></pre></div>

</div>
</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="entering-and-cleaning-data-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-a-vocabulary.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/geanders/RProgrammingForResearch/edit/master/07-exploringdata2.Rmd",
"text": "Edit"
},
"download": ["RProgrammingForResearch.pdf", "RProgrammingForResearch.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
